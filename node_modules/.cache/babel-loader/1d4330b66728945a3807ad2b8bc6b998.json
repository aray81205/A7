{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\alphacamp\\\\todolist-react-starter\\\\src\\\\Contexts\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { login, register, checkPermission } from 'API/Auth';\nimport { createContext, useState, useEffect } from 'react';\nimport * as jwt from 'jsonwebtoken';\nimport { useLocation } from 'react-router-dom';\nimport { useContext } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultAuthContext = {\n  isAuthenticated: false,\n  // 使用者是否登入的判斷依據，預設為 false，若取得後端的有效憑證，則切換為 true\n  currentMember: null,\n  // 當前使用者相關資料，預設為 null，成功登入後就會有使用者資料\n  register: null,\n  // 註冊方法\n  login: null,\n  // 登入方法\n  logout: null // 登入方法\n};\n\nconst AuthContext = /*#__PURE__*/createContext(defaultAuthContext);\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = _ref => {\n  _s2();\n  let {\n    children\n  } = _ref;\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [payload, setPayload] = useState(null);\n  const {\n    pathname\n  } = useLocation();\n  useEffect(() => {\n    const checkTokenIsValid = async () => {\n      const authToken = localStorage.getItem('authToken');\n      if (!authToken) {\n        setIsAuthenticated(false);\n        setPayload(null);\n        return;\n      }\n      const result = await checkPermission(authToken);\n      if (result) {\n        setIsAuthenticated(true);\n        const temPayload = jwt.decode(authToken);\n        setPayload(temPayload);\n      } else {\n        setIsAuthenticated(false);\n        setPayload(null);\n      }\n    };\n    checkTokenIsValid();\n  }, [pathname]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      isAuthenticated,\n      currentMember: payload && {\n        id: payload.sub,\n        name: payload.name\n      },\n      register: async _ref2 => {\n        let {\n          data\n        } = _ref2;\n        const {\n          success,\n          authToken\n        } = await register({\n          username: data.username,\n          email: data.email,\n          password: data.password\n        });\n        const temPayload = jwt.decode(authToken);\n        if (temPayload) {\n          setPayload(temPayload);\n          setIsAuthenticated(true);\n          localStorage.setItem('authToken', authToken);\n        } else {\n          setPayload(null);\n          setIsAuthenticated(false);\n        }\n        return success;\n      },\n      login: async data => {\n        const {\n          success,\n          authToken\n        } = await login({\n          username: data.username,\n          password: data.password\n        });\n        const temPayload = jwt.decode(authToken);\n        if (temPayload) {\n          setPayload(temPayload);\n          setIsAuthenticated(true);\n          localStorage.setItem('authToken', authToken);\n        } else {\n          setPayload(null);\n          setIsAuthenticated(false);\n        }\n        return success;\n      },\n      logout: () => {\n        localStorage.removeItem('authToken');\n        setPayload(null);\n        setIsAuthenticated(false);\n      }\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"wtihcEB86EXT6shY4tnrdtrhlRc=\", false, function () {\n  return [useLocation];\n});\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["login","register","checkPermission","createContext","useState","useEffect","jwt","useLocation","useContext","jsxDEV","_jsxDEV","defaultAuthContext","isAuthenticated","currentMember","logout","AuthContext","useAuth","_s","AuthProvider","_ref","_s2","children","setIsAuthenticated","payload","setPayload","pathname","checkTokenIsValid","authToken","localStorage","getItem","result","temPayload","decode","Provider","value","id","sub","name","_ref2","data","success","username","email","password","setItem","removeItem","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/User/alphacamp/todolist-react-starter/src/Contexts/AuthContext.jsx"],"sourcesContent":["import { login, register, checkPermission } from 'API/Auth';\r\nimport { createContext, useState, useEffect } from 'react';\r\nimport * as jwt from 'jsonwebtoken';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useContext } from 'react';\r\n\r\nconst defaultAuthContext = {\r\n  isAuthenticated: false, // 使用者是否登入的判斷依據，預設為 false，若取得後端的有效憑證，則切換為 true\r\n  currentMember: null, // 當前使用者相關資料，預設為 null，成功登入後就會有使用者資料\r\n  register: null, // 註冊方法\r\n  login: null, // 登入方法\r\n  logout: null, // 登入方法\r\n};\r\n\r\nconst AuthContext = createContext(defaultAuthContext);\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [payload, setPayload] = useState(null);\r\n\r\n  const { pathname } = useLocation();\r\n\r\n  useEffect(() => {\r\n    const checkTokenIsValid = async () => {\r\n      const authToken = localStorage.getItem('authToken');\r\n      if (!authToken) {\r\n        setIsAuthenticated(false);\r\n        setPayload(null);\r\n        return;\r\n      }\r\n      const result = await checkPermission(authToken);\r\n      if (result) {\r\n        setIsAuthenticated(true);\r\n        const temPayload = jwt.decode(authToken);\r\n        setPayload(temPayload);\r\n      } else {\r\n        setIsAuthenticated(false);\r\n        setPayload(null);\r\n      }\r\n    };\r\n\r\n    checkTokenIsValid();\r\n  }, [pathname]);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isAuthenticated,\r\n        currentMember: payload && {\r\n          id: payload.sub,\r\n          name: payload.name,\r\n        },\r\n        register: async ({ data }) => {\r\n          const { success, authToken } = await register({\r\n            username: data.username,\r\n            email: data.email,\r\n            password: data.password,\r\n          });\r\n          const temPayload = jwt.decode(authToken);\r\n          if (temPayload) {\r\n            setPayload(temPayload);\r\n            setIsAuthenticated(true);\r\n            localStorage.setItem('authToken', authToken);\r\n          } else {\r\n            setPayload(null);\r\n            setIsAuthenticated(false);\r\n          }\r\n          return success;\r\n        },\r\n        login: async (data) => {\r\n          const { success, authToken } = await login({\r\n            username: data.username,\r\n            password: data.password,\r\n          });\r\n          const temPayload = jwt.decode(authToken);\r\n          if (temPayload) {\r\n            setPayload(temPayload);\r\n            setIsAuthenticated(true);\r\n            localStorage.setItem('authToken', authToken);\r\n          } else {\r\n            setPayload(null);\r\n            setIsAuthenticated(false);\r\n          }\r\n          return success;\r\n        },\r\n        logout: () => {\r\n          localStorage.removeItem('authToken');\r\n          setPayload(null);\r\n          setIsAuthenticated(false);\r\n        },\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}