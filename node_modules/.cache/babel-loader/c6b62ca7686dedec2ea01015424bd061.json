{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/User/alphacamp/todolist-react-starter/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/User/alphacamp/todolist-react-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/User/alphacamp/todolist-react-starter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{login as _login,register as _register,checkPermission}from'API/Auth';import{createContext,useState,useEffect}from'react';import*as jwt from'jsonwebtoken';import{useLocation}from'react-router-dom';import{useContext}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";var defaultAuthContext={isAuthenticated:false,currentMember:null,register:null,login:null,logout:null};var AuthContext=/*#__PURE__*/createContext(defaultAuthContext);export var useAuth=function useAuth(){return useContext(AuthContext);};export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAuthenticated=_useState2[0],setIsAuthenticated=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),payload=_useState4[0],setPayload=_useState4[1];var _useLocation=useLocation(),pathname=_useLocation.pathname;useEffect(function(){var checkTokenIsValid=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var authToken,result,tempPayload;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:authToken=localStorage.getItem('authToken');if(authToken){_context.next=5;break;}setIsAuthenticated(false);setPayload(null);return _context.abrupt(\"return\");case 5:_context.next=7;return checkPermission(authToken);case 7:result=_context.sent;if(result){setIsAuthenticated(true);tempPayload=jwt.decode(authToken);setPayload(tempPayload);}else{setIsAuthenticated(false);setPayload(null);}case 9:case\"end\":return _context.stop();}},_callee);}));return function checkTokenIsValid(){return _ref2.apply(this,arguments);};}();checkTokenIsValid();},[pathname]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated:isAuthenticated,currentMember:payload&&{id:payload.sub,name:payload.name},register:function(){var _register2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){var _yield$_register,success,authToken,tempPayload;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _register({username:data.username,email:data.email,password:data.password});case 2:_yield$_register=_context2.sent;success=_yield$_register.success;authToken=_yield$_register.authToken;tempPayload=jwt.decode(authToken);if(tempPayload){setPayload(tempPayload);setIsAuthenticated(true);localStorage.setItem('authToken',authToken);}else{setPayload(null);setIsAuthenticated(false);}return _context2.abrupt(\"return\",success);case 8:case\"end\":return _context2.stop();}},_callee2);}));function register(_x){return _register2.apply(this,arguments);}return register;}(),login:function(){var _login2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(data){var _yield$_login,success,authToken,tempPayload;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _login({username:data.username,password:data.password});case 2:_yield$_login=_context3.sent;success=_yield$_login.success;authToken=_yield$_login.authToken;tempPayload=jwt.decode(authToken);if(tempPayload){setPayload(tempPayload);setIsAuthenticated(true);localStorage.setItem('authToken',authToken);}else{setPayload(null);setIsAuthenticated(false);}return _context3.abrupt(\"return\",success);case 8:case\"end\":return _context3.stop();}},_callee3);}));function login(_x2){return _login2.apply(this,arguments);}return login;}(),logout:function logout(){localStorage.removeItem('authToken');setPayload(null);setIsAuthenticated(false);}},children:children});};","map":{"version":3,"names":["login","register","checkPermission","createContext","useState","useEffect","jwt","useLocation","useContext","jsx","_jsx","defaultAuthContext","isAuthenticated","currentMember","logout","AuthContext","useAuth","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","setIsAuthenticated","_useState3","_useState4","payload","setPayload","_useLocation","pathname","checkTokenIsValid","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","authToken","result","tempPayload","wrap","_callee$","_context","prev","next","localStorage","getItem","abrupt","sent","decode","stop","apply","arguments","Provider","value","id","sub","name","_register2","_callee2","data","_yield$_register","success","_callee2$","_context2","username","email","password","setItem","_x","_login2","_callee3","_yield$_login","_callee3$","_context3","_x2","removeItem"],"sources":["C:/Users/User/alphacamp/todolist-react-starter/src/Contexts/AuthContext.jsx"],"sourcesContent":["import { login, register, checkPermission } from 'API/Auth';\r\nimport { createContext, useState, useEffect } from 'react';\r\nimport * as jwt from 'jsonwebtoken';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useContext } from 'react';\r\n\r\nconst defaultAuthContext = {\r\n  isAuthenticated: false,\r\n  currentMember: null,\r\n  register: null,\r\n  login: null,\r\n  logout: null,\r\n};\r\n\r\nconst AuthContext = createContext(defaultAuthContext);\r\nexport const useAuth = () => useContext(AuthContext);\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [payload, setPayload] = useState(null);\r\n  const { pathname } = useLocation();\r\n\r\n  useEffect(() => {\r\n    const checkTokenIsValid = async () => {\r\n      const authToken = localStorage.getItem('authToken');\r\n      if (!authToken) {\r\n        setIsAuthenticated(false);\r\n        setPayload(null);\r\n        return;\r\n      }\r\n      const result = await checkPermission(authToken);\r\n      if (result) {\r\n        setIsAuthenticated(true);\r\n        const tempPayload = jwt.decode(authToken);\r\n        setPayload(tempPayload);\r\n      } else {\r\n        setIsAuthenticated(false);\r\n        setPayload(null);\r\n      }\r\n    };\r\n\r\n    checkTokenIsValid();\r\n  }, [pathname]);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isAuthenticated,\r\n        currentMember: payload && {\r\n          id: payload.sub,\r\n          name: payload.name,\r\n        },\r\n        register: async (data) => {\r\n          const { success, authToken } = await register({\r\n            username: data.username,\r\n            email: data.email,\r\n            password: data.password,\r\n          });\r\n          const tempPayload = jwt.decode(authToken);\r\n          if (tempPayload) {\r\n            setPayload(tempPayload);\r\n            setIsAuthenticated(true);\r\n            localStorage.setItem('authToken', authToken);\r\n          } else {\r\n            setPayload(null);\r\n            setIsAuthenticated(false);\r\n          }\r\n          return success;\r\n        },\r\n        login: async (data) => {\r\n          const { success, authToken } = await login({\r\n            username: data.username,\r\n            password: data.password,\r\n          });\r\n          const tempPayload = jwt.decode(authToken);\r\n          if (tempPayload) {\r\n            setPayload(tempPayload);\r\n            setIsAuthenticated(true);\r\n            localStorage.setItem('authToken', authToken);\r\n          } else {\r\n            setPayload(null);\r\n            setIsAuthenticated(false);\r\n          }\r\n          return success;\r\n        },\r\n        logout: () => {\r\n          localStorage.removeItem('authToken');\r\n          setPayload(null);\r\n          setIsAuthenticated(false);\r\n        },\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}